!function(){function e(e,t){for(;e&&(8===e.nodeType||3===e.nodeType&&/^[ \t\n\r]*$/.test(e.nodeValue));)e=t(e);return e}function t(t){return e(t,function(e){return e.previousSibling})}function n(t){return e(t,function(e){return e.nextSibling})}function i(e,t,n){return e.dom.getParent(t,function(e){return-1!==tinymce.inArray(n,e)})}function o(e){return e&&("OL"===e.tagName||"UL"===e.tagName)}function r(e,n){var i,r,a;for(i=t(e.lastChild);o(i);)r=i,i=t(r.previousSibling);return r&&(a=n.create("li",{style:"list-style-type: none;"}),n.split(e,r),n.insertAfter(a,r),a.appendChild(r),a.appendChild(r),e=a.previousSibling),e}function a(e,t,n){return e=d(e,t,n),s(e,t,n)}function d(e,n,i){var o=t(e.previousSibling);return o?l(o,e,n?o:!1,i):e}function s(e,t,i){var o=n(e.nextSibling);return o?l(e,o,t?o:!1,i):e}function l(e,t,n,i){return c(e,t,!!n,i)?f(e,t,n):(e&&"LI"===e.tagName&&o(t)&&e.appendChild(t),t)}function c(e,t,n,i){return e&&t?"LI"===e.tagName&&"LI"===t.tagName?"none"===t.style.listStyleType||m(t):o(e)?e.tagName===t.tagName&&(n||e.style.listStyleType===t.style.listStyleType)||u(t):i&&"P"===e.tagName&&"P"===t.tagName:!1}function u(e){var i=n(e.firstChild),r=t(e.lastChild);return i&&r&&o(e)&&i===r&&(o(i)||"none"===i.style.listStyleType||m(i))}function m(e){var i=n(e.firstChild),r=t(e.lastChild);return i&&r&&i===r&&o(i)}function f(e,i,o){var r=t(e.lastChild),a=n(i.firstChild);for("P"===e.tagName&&e.appendChild(e.ownerDocument.createElement("br"));i.firstChild;)e.appendChild(i.firstChild);return o&&(e.style.listStyleType=o.style.listStyleType),i.parentNode.removeChild(i),l(r,a,!1),e}function g(e,t){var n;return t.is(e,"li,ol,ul")||(n=t.getParent(e,"li"),n&&(e=n)),e}var p,h=tinymce.each,N=tinymce.dom.Event;tinymce.create("tinymce.plugins.Lists",{init:function(e){function t(t){return t.keyCode===tinymce.VK.TAB&&!(t.altKey||t.ctrlKey)&&(e.queryCommandState("InsertUnorderedList")||e.queryCommandState("InsertOrderedList"))}function n(){var e=a(),t=e.parentNode.parentNode,n=e.parentNode.lastChild===e;return n&&!i(t)&&d(e)}function i(e){return o(e)?e.parentNode&&"LI"===e.parentNode.tagName:"LI"===e.tagName}function r(){return e.selection.isCollapsed()&&d(a())}function a(){var t=e.selection.getStart();return"BR"!=t.tagName&&""!=t.tagName||"LI"!=t.parentNode.tagName?t:t.parentNode}function d(e){var t=e.childNodes.length;return"LI"===e.tagName?0==t?!0:1==t&&(""==e.firstChild.tagName||"BR"==e.firstChild.tagName||s(e)):!1}function s(e){var t=tinymce.grep(e.parentNode.childNodes,function(e){return"LI"==e.tagName}),n=e==t[t.length-1],i=e.firstChild;return tinymce.isIE9&&n&&(i.nodeValue==String.fromCharCode(160)||i.nodeValue==String.fromCharCode(32))}function l(e){return e.keyCode===tinymce.VK.ENTER}function c(e){return l(e)&&!e.shiftKey}function u(e){return t(e)?b:c(e)&&n()?A:c(e)&&r()?k:A}function m(e,t){(E==b||E==k||tinymce.isGecko&&E==B)&&N.cancel(t)}function f(){var t=e.selection.getRng(!0),n=t.startContainer;if(3==n.nodeType){var i=n.nodeValue;return tinymce.isIE9&&i.length>1&&32==i.charCodeAt(i.length-1)?t.endOffset==i.length-1:t.endOffset==i.length}return 1==n.nodeType?t.endOffset==n.childNodes.length:!1}function g(){var t=e.selection.getNode(),n="h1,h2,h3,h4,h5,h6,p,div",i=e.dom.is(t,n)&&"LI"===t.parentNode.tagName&&t.parentNode.lastChild===t;return e.selection.isCollapsed()&&i&&f()}function p(e,t){if(c(t)&&g()){var n=e.selection.getNode(),i=e.dom.create("li"),o=e.dom.getParent(n,"li");e.dom.insertAfter(i,o),tinymce.isIE6||tinymce.isIE7||tinyMCE.isIE8?e.selection.setCursorLocation(i,1):e.selection.setCursorLocation(i,0),t.preventDefault()}}function h(e,t){function n(e){var t=e.firstChild,n=null;do{if(!t)break;"LI"===t.tagName&&(n=t)}while(t=t.nextSibling);return n}function i(e,t){for(;e.childNodes.length>0;)t.appendChild(e.childNodes[0])}var o;if(tinymce.isGecko){var r=e.selection.getStart();if(t.keyCode==tinymce.VK.BACKSPACE&&"IMG"===r.tagName&&(o=r.parentNode.previousSibling)){var a;if("UL"===o.tagName||"OL"===o.tagName)a=o;else{if(!o.previousSibling||"UL"!==o.previousSibling.tagName&&"OL"!==o.previousSibling.tagName)return;a=o.previousSibling}var d=n(a),s=e.dom.createRng();s.setStart(d,1),s.setEnd(d,1),e.selection.setRng(s),e.selection.collapse(!0);var l=e.selection.getBookmark(),c=r.parentNode.cloneNode(!0);"P"===c.tagName||"DIV"===c.tagName?i(c,d):d.appendChild(c),r.parentNode.parentNode.removeChild(r.parentNode),e.selection.moveToBookmark(l)}}}function y(t){var n=e.dom.getParent(t,"ol,ul");if(null!=n){var i=n.lastChild;e.selection.setCursorLocation(i,0)}}function v(t,n){var i=e.getDoc().createTextNode("﻿");t.insertBefore(i,n),e.selection.setCursorLocation(i,0),e.execCommand("mceRepaint")}function C(e,t){if(l(t)){var n=a();if(n){var i=n.parentNode,o=i&&i.parentNode;o&&"LI"==o.nodeName&&o.firstChild==i&&n==i.firstChild&&v(o,i)}}}function S(e,t){if(l(t)){var n=a();if(1===e.dom.select("ul li",n).length){var i=n.firstChild;v(n,i)}}}function I(e,t){function n(t,n){for(var i=[],o=new tinymce.dom.TreeWalker(n,t),r=o.current();r;r=o.next())e.dom.is(r,"ol,ul,li")&&i.push(r);return i}if(t.keyCode==tinymce.VK.BACKSPACE){var i=a();if(i){var o=e.dom.getParent(i,"ol,ul");if(o&&o.firstChild===i){var r=n(o,i);return e.execCommand("Outdent",!1,r),e.undoManager.add(),N.cancel(t)}}}}function L(e,t){var n=a();if(t.keyCode===tinymce.VK.BACKSPACE&&e.dom.is(n,"li")&&n.parentNode.firstChild!==n&&1===e.dom.select("ul,ol",n).length){var i=n.previousSibling;e.dom.remove(e.dom.select("br",n)),e.dom.remove(n,!0);var o=tinymce.grep(i.childNodes,function(e){return 3===e.nodeType});if(1===o.length){var r=o[0];e.selection.setCursorLocation(r,r.length)}return e.undoManager.add(),N.cancel(t)}}var b="TABBING",k="EMPTY",B="ESCAPE",A="UNKNOWN",E=A;this.ed=e,e.addCommand("Indent",this.indent,this),e.addCommand("Outdent",this.outdent,this),e.addCommand("InsertUnorderedList",function(){this.applyList("UL","OL")},this),e.addCommand("InsertOrderedList",function(){this.applyList("OL","UL")},this),e.onInit.add(function(){e.editorCommands.addCommands({outdent:function(){function t(t){return t=i.getParent(t,i.isBlock),t&&parseInt(e.dom.getStyle(t,"margin-left")||0,10)+parseInt(e.dom.getStyle(t,"padding-left")||0,10)>0}var n=e.selection,i=e.dom;return t(n.getStart())||t(n.getEnd())||e.queryCommandState("InsertOrderedList")||e.queryCommandState("InsertUnorderedList")}},"state")}),e.onKeyUp.add(function(e,t){if(E==b)return e.execCommand(t.shiftKey?"Outdent":"Indent",!0,null),E=A,N.cancel(t);if(E==k){var n=a(),i=e.settings.list_outdent_on_enter===!0||t.shiftKey;return e.execCommand(i?"Outdent":"Indent",!0,null),tinymce.isIE&&y(n),N.cancel(t)}if(E==B)if(tinymce.isIE6||tinymce.isIE7||tinymce.isIE8){var o=e.getDoc().createTextNode("﻿");e.selection.getNode().appendChild(o)}else if(tinymce.isIE9||tinymce.isGecko)return e.execCommand("Outdent"),N.cancel(t)}),e.onKeyDown.add(function(e,t){E=u(t)}),e.onKeyDown.add(m),e.onKeyDown.add(h),e.onKeyDown.add(p),tinymce.isGecko&&e.onKeyUp.add(C),tinymce.isIE8&&e.onKeyUp.add(S),(tinymce.isGecko||tinymce.isWebKit)&&e.onKeyDown.add(I),tinymce.isWebKit&&e.onKeyDown.add(L)},applyList:function(e,t){function n(e){e&&"BR"===e.tagName&&y.remove(e)}function i(t){function i(e){(e.style.marginLeft||e.style.paddingLeft)&&f.adjustPaddingFunction(!1)(e)}var r,s=y.create(e);if("LI"===t.tagName);else{if("P"===t.tagName||"DIV"===t.tagName||"BODY"===t.tagName)return d(t,function(e,a){o(e,a,"BODY"===t.tagName?null:e.parentNode),r=e.parentNode,i(r),n(a)}),r&&("LI"===r.tagName&&("P"===t.tagName||L.length>1)&&y.split(r.parentNode.parentNode,r.parentNode),a(r.parentNode,!0)),void 0;r=y.create("li"),y.insertAfter(r,t),r.appendChild(t),i(t),t=r}y.insertAfter(s,t),s.appendChild(t),a(s,!0),v.push(t)}function o(e,t,n){for(var o,r,a=e;!y.isBlock(e.parentNode)&&e.parentNode!==y.getRoot();)e=y.split(e.parentNode,e.previousSibling),e=e.nextSibling,a=e;if(n){for(o=n.cloneNode(!0),e.parentNode.insertBefore(o,e);o.firstChild;)y.remove(o.firstChild);o=y.rename(o,"li")}else o=y.create("li"),e.parentNode.insertBefore(o,e);for(;a&&a!=t;)r=a.nextSibling,o.appendChild(a),a=r;0===o.childNodes.length&&(o.innerHTML='<br _mce_bogus="1" />'),i(o)}function d(e,t){function n(e,t){var n,i=y.createRng();return p.keep=!0,N.selection.moveToBookmark(p),p.keep=!1,n=N.selection.getRng(!0),t||(t=e.parentNode.lastChild),i.setStartBefore(e),i.setEndAfter(t),!(i.compareBoundaryPoints(a,n)>0||i.compareBoundaryPoints(d,n)<=0)}function i(e){return e.nextSibling?e.nextSibling:y.isBlock(e.parentNode)||e.parentNode===y.getRoot()?void 0:i(e.parentNode)}var o,r,a=3,d=1,s="br,ul,ol,p,div,h1,h2,h3,h4,h5,h6,table,blockquote,address,pre,form,center,dl";o=e.firstChild;var l=!1;h(y.select(s,e),function(e){return e.hasAttribute&&e.hasAttribute("_mce_bogus")?!0:(n(o,e)&&(y.addClass(e,"_mce_tagged_br"),o=i(e)),void 0)}),l=o&&n(o,void 0),o=e.firstChild,h(y.select(s,e),function(e){var n=i(e);return e.hasAttribute&&e.hasAttribute("_mce_bogus")?!0:(y.hasClass(e,"_mce_tagged_br")?(t(o,e,r),r=null):r=e,o=n,void 0)}),l&&t(o,void 0,r)}function l(e){d(e,function(e,t,i){o(e,t),n(t),n(i)})}function c(e){-1===tinymce.inArray(v,e)&&(e.parentNode.tagName===t&&(y.split(e.parentNode,e),i(e),s(e.parentNode,!1)),v.push(e))}function u(e){var t,n,i,o;if(-1===tinymce.inArray(v,e)){for(e=r(e,y);y.is(e.parentNode,"ol,ul,li");)y.split(e.parentNode,e);if(v.push(e),e=y.rename(e,"p"),i=a(e,!1,N.settings.force_br_newlines),i===e)for(t=e.firstChild;t;)y.isBlock(t)?(t=y.split(t.parentNode,t),o=!0,n=t.nextSibling&&t.nextSibling.firstChild):(n=t.nextSibling,o&&"BR"===t.tagName&&y.remove(t),o=!1),t=n}}var m,f=this,N=f.ed,y=N.dom,v=[],C=!1,S=!1,I=!1,L=N.selection.getSelectedBlocks();h(L,function(n){n=g(n,y),n.tagName===t||"LI"===n.tagName&&n.parentNode.tagName===t?S=!0:n.tagName===e||"LI"===n.tagName&&n.parentNode.tagName===e?C=!0:I=!0}),m=I&&!C||S||0===L.length?{LI:c,H1:i,H2:i,H3:i,H4:i,H5:i,H6:i,P:i,BODY:i,DIV:L.length>1?i:l,defaultAction:l,elements:this.selectedBlocks()}:{defaultAction:u,elements:this.selectedBlocks()},this.process(m)},indent:function(){function e(e){var t=d.create("li",{style:"list-style-type: none;"});return d.insertAfter(t,e),t}function t(t){var n,i=e(t),o=d.getParent(t,"ol,ul"),r=o.tagName,a=d.getStyle(o,"list-style-type"),s={};return""!==a&&(s.style="list-style-type: "+a+";"),n=d.create(r,s),i.appendChild(n),n}function n(e){if(!i(o,e,s)){e=r(e,d);var n=t(e);n.appendChild(e),a(n.parentNode,!1),a(n,!1),s.push(e)}}var o=this.ed,d=o.dom,s=[];this.process({LI:n,defaultAction:this.adjustPaddingFunction(!0),elements:this.selectedBlocks()})},outdent:function(e,t){function n(e){var t,n,a;if(!i(d,e,l)){if(""!==s.getStyle(e,"margin-left")||""!==s.getStyle(e,"padding-left"))return o.adjustPaddingFunction(!1)(e);if(a=s.getStyle(e,"text-align",!0),"center"===a||"right"===a)return s.setStyle(e,"text-align","left"),void 0;e=r(e,s),t=e.parentNode,n=e.parentNode.parentNode,"P"===n.tagName?s.split(n,e.parentNode):(s.split(t,e),"LI"===n.tagName?s.split(n,e):s.is(n,"ol,ul")||s.rename(e,"p")),l.push(e)}}var o=this,d=o.ed,s=d.dom,l=[],c=t&&tinymce.is(t,"array")?t:this.selectedBlocks();this.process({LI:n,defaultAction:this.adjustPaddingFunction(!1),elements:c}),h(l,a)},process:function(e){function t(e){var t=tinymce.grep(e.childNodes,function(e){return!("BR"===e.nodeName||"SPAN"===e.nodeName&&"bookmark"==c.getAttrib(e,"data-mce-type")||3==e.nodeType&&(e.nodeValue==String.fromCharCode(160)||""==e.nodeValue))});return 0===t.length}function n(n){if(c.removeClass(n,"_mce_act_on"),n&&1===n.nodeType&&!(a.length>1&&t(n))){n=g(n,c);var i=e[n.tagName];i||(i=e.defaultAction),i(n)}}function i(e){s.splitSafeEach(e.childNodes,n)}function o(e,t){return t>=0&&e.hasChildNodes()&&t<e.childNodes.length&&"BR"===e.childNodes[t].tagName}function r(){var e=l.getNode(),t=c.getParent(e,"td");return null!==t}var a,d,s=this,l=s.ed.selection,c=s.ed.dom;if(a=e.elements,d=l.getRng(!0),d.collapsed||(o(d.endContainer,d.endOffset-1)&&(d.setEnd(d.endContainer,d.endOffset-1),l.setRng(d)),o(d.startContainer,d.startOffset)&&(d.setStart(d.startContainer,d.startOffset+1),l.setRng(d))),tinymce.isIE8){var u=s.ed.selection.getNode();if("LI"===u.tagName&&u.parentNode.lastChild!==u){var m=s.ed.getDoc().createTextNode("﻿");u.appendChild(m)}}p=l.getBookmark(),e.OL=e.UL=i,s.splitSafeEach(a,n),l.moveToBookmark(p),p=null,r()||s.ed.execCommand("mceRepaint")},splitSafeEach:function(e,t){tinymce.isGecko&&(/Firefox\/[12]\.[0-9]/.test(navigator.userAgent)||/Firefox\/3\.[0-4]/.test(navigator.userAgent))?this.classBasedEach(e,t):h(e,t)},classBasedEach:function(e,t){var n,i,o=this.ed.dom;for(h(e,function(e){o.addClass(e,"_mce_act_on")}),n=o.select("._mce_act_on");n.length>0;)i=n.shift(),o.removeClass(i,"_mce_act_on"),t(i),n=o.select("._mce_act_on")},adjustPaddingFunction:function(e){var t,n,i=this.ed;return t=i.settings.indentation,n=/[a-z%]+/i.exec(t),t=parseInt(t,10),function(o){var r,a;r=parseInt(i.dom.getStyle(o,"margin-left")||0,10)+parseInt(i.dom.getStyle(o,"padding-left")||0,10),a=e?r+t:r-t,i.dom.setStyle(o,"padding-left",""),i.dom.setStyle(o,"margin-left",a>0?a+n:"")}},selectedBlocks:function(){var e=this.ed,t=e.selection.getSelectedBlocks();return 0==t.length?[e.dom.getRoot()]:t},getInfo:function(){return{longname:"Lists",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/lists",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("lists",tinymce.plugins.Lists)}();
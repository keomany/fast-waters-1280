!function(){function e(e){return document.getElementById(e)}function t(e){var i,o,a,s;if(null==e||"object"!=typeof e)return e;if("length"in e){for(a=[],i=0,o=e.length;o>i;++i)a[i]=t(e[i]);return a}a={};for(s in e)e.hasOwnProperty(s)&&(a[s]=t(e[s]));return a}function i(t){var i=e(t);return"SELECT"==i.nodeName?i.options[i.selectedIndex].value:"checkbox"==i.type?i.checked:i.value}function o(t,i,o){if("undefined"!=typeof i&&null!=i){var a=e(t);"SELECT"==a.nodeName?selectByValue(document.forms[0],t,i):"checkbox"==a.type?("string"==typeof i&&(i=i.toLowerCase(),i=!o&&"true"===i||o&&i===o.toLowerCase()),a.checked=!!i):a.value=i}}var a;(a=tinyMCEPopup.getParam("media_external_list_url"))&&document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(a)+'"></script>'),window.Media={init:function(){var i,o,a=this;a.editor=o=tinyMCEPopup.editor,e("filebrowsercontainer").innerHTML=getBrowserHTML("filebrowser","src","media","media"),e("qtsrcfilebrowsercontainer").innerHTML=getBrowserHTML("qtsrcfilebrowser","quicktime_qtsrc","media","media"),e("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor"),e("video_altsource1_filebrowser").innerHTML=getBrowserHTML("video_filebrowser_altsource1","video_altsource1","media","media"),e("video_altsource2_filebrowser").innerHTML=getBrowserHTML("video_filebrowser_altsource2","video_altsource2","media","media"),e("audio_altsource1_filebrowser").innerHTML=getBrowserHTML("audio_filebrowser_altsource1","audio_altsource1","media","media"),e("audio_altsource2_filebrowser").innerHTML=getBrowserHTML("audio_filebrowser_altsource2","audio_altsource2","media","media"),e("video_poster_filebrowser").innerHTML=getBrowserHTML("filebrowser_poster","video_poster","media","image"),i=a.getMediaListHTML("medialist","src","media","media"),""==i?e("linklistrow").style.display="none":e("linklistcontainer").innerHTML=i,isVisible("filebrowser")&&(e("src").style.width="230px"),isVisible("video_filebrowser_altsource1")&&(e("video_altsource1").style.width="220px"),isVisible("video_filebrowser_altsource2")&&(e("video_altsource2").style.width="220px"),isVisible("audio_filebrowser_altsource1")&&(e("audio_altsource1").style.width="220px"),isVisible("audio_filebrowser_altsource2")&&(e("audio_altsource2").style.width="220px"),isVisible("filebrowser_poster")&&(e("video_poster").style.width="220px"),o.dom.setOuterHTML(e("media_type"),a.getMediaTypeHTML(o)),a.setDefaultDialogSettings(o),a.data=t(tinyMCEPopup.getWindowArg("data")),a.dataToForm(),a.preview(),updateColor("bgcolor_pick","bgcolor")},insert:function(){var e=tinyMCEPopup.editor;this.formToData(),e.execCommand("mceRepaint"),tinyMCEPopup.restoreSelection(),e.selection.setNode(e.plugins.media.dataToImg(this.data)),tinyMCEPopup.close()},preview:function(){e("prev").innerHTML=this.editor.plugins.media.dataToHtml(this.data,!0)},moveStates:function(t,a){function s(e){var t={};return e&&tinymce.each(e.split("&"),function(e){var i=e.split("=");t[unescape(i[0])]=unescape(i[1])}),t}function r(e,a){var s,r,d,n,l;if(e==u.type||"global"==e)for(a=tinymce.explode(a),s=0;s<a.length;s++)r=a[s],d="global"==e?r:e+"_"+r,"global"==e?l=u:"video"==e||"audio"==e?(l=u.video.attrs,l||t||(u.video.attrs=l={})):l=u.params,l&&(t?o(d,l[r],"video"==e||"audio"==e?r:""):(delete l[r],n=i(d),"video"!=e&&"audio"!=e||n!==!0||(n=r),c[d]?n!==c[d]&&(n=""+n,l[r]=n):n&&(n=""+n,l[r]=n)))}var d,n,l,c,n,u=this.data,p=this.editor,h=p.plugins.media;c={quicktime_autoplay:!0,quicktime_controller:!0,flash_play:!0,flash_loop:!0,flash_menu:!0,windowsmedia_autostart:!0,windowsmedia_enablecontextmenu:!0,windowsmedia_invokeurls:!0,realmedia_autogotourl:!0,realmedia_imagestatus:!0},t||(u.type=e("media_type").options[e("media_type").selectedIndex].value,u.width=i("width"),u.height=i("height"),n=i("src"),"src"==a&&(d=n.replace(/^.*\.([^.]+)$/,"$1"),(l=h.getType(d))&&(u.type=l.name.toLowerCase()),o("media_type",u.type)),("video"==u.type||"audio"==u.type)&&(u.video.sources||(u.video.sources=[]),u.video.sources[0]={src:i("src")})),e("video_options").style.display="none",e("audio_options").style.display="none",e("flash_options").style.display="none",e("quicktime_options").style.display="none",e("shockwave_options").style.display="none",e("windowsmedia_options").style.display="none",e("realmedia_options").style.display="none",e("embeddedaudio_options").style.display="none",e(u.type+"_options")&&(e(u.type+"_options").style.display="block"),o("media_type",u.type),r("flash","play,loop,menu,swliveconnect,quality,scale,salign,wmode,base,flashvars"),r("quicktime","loop,autoplay,cache,controller,correction,enablejavascript,kioskmode,autohref,playeveryframe,targetcache,scale,starttime,endtime,target,qtsrcchokespeed,volume,qtsrc"),r("shockwave","sound,progress,autostart,swliveconnect,swvolume,swstretchstyle,swstretchhalign,swstretchvalign"),r("windowsmedia","autostart,enabled,enablecontextmenu,fullscreen,invokeurls,mute,stretchtofit,windowlessvideo,balance,baseurl,captioningid,currentmarker,currentposition,defaultframe,playcount,rate,uimode,volume"),r("realmedia","autostart,loop,autogotourl,center,imagestatus,maintainaspect,nojava,prefetch,shuffle,console,controls,numloop,scriptcallbacks"),r("video","poster,autoplay,loop,muted,preload,controls"),r("audio","autoplay,loop,preload,controls"),r("embeddedaudio","autoplay,loop,controls"),r("global","id,name,vspace,hspace,bgcolor,align,width,height"),t?"video"==u.type?(u.video.sources[0]&&o("src",u.video.sources[0].src),n=u.video.sources[1],n&&o("video_altsource1",n.src),n=u.video.sources[2],n&&o("video_altsource2",n.src)):"audio"==u.type?(u.video.sources[0]&&o("src",u.video.sources[0].src),n=u.video.sources[1],n&&o("audio_altsource1",n.src),n=u.video.sources[2],n&&o("audio_altsource2",n.src)):("flash"==u.type&&tinymce.each(p.getParam("flash_video_player_flashvars",{url:"$url",poster:"$poster"}),function(e,t){"$url"==e&&(u.params.src=s(u.params.flashvars)[t]||u.params.src||"")}),o("src",u.params.src)):(n=i("src"),n.match(/youtu.be\/[a-z1-9.-_]+/)&&(u.width=425,u.height=350,u.params.frameborder="0",u.type="iframe",n="http://www.youtube.com/embed/"+n.match(/youtu.be\/([a-z1-9.-_]+)/)[1],o("src",n),o("media_type",u.type)),n.match(/youtube.com(.+)v=([^&]+)/)&&(u.width=425,u.height=350,u.params.frameborder="0",u.type="iframe",n="http://www.youtube.com/embed/"+n.match(/v=([^&]+)/)[1],o("src",n),o("media_type",u.type)),n.match(/video.google.com(.+)docid=([^&]+)/)&&(u.width=425,u.height=326,u.type="flash",n="http://video.google.com/googleplayer.swf?docId="+n.match(/docid=([^&]+)/)[1]+"&hl=en",o("src",n),o("media_type",u.type)),"video"==u.type?(u.video.sources||(u.video.sources=[]),u.video.sources[0]={src:n},n=i("video_altsource1"),n&&(u.video.sources[1]={src:n}),n=i("video_altsource2"),n&&(u.video.sources[2]={src:n})):"audio"==u.type?(u.video.sources||(u.video.sources=[]),u.video.sources[0]={src:n},n=i("audio_altsource1"),n&&(u.video.sources[1]={src:n}),n=i("audio_altsource2"),n&&(u.video.sources[2]={src:n})):u.params.src=n,o("width",u.width||("audio"==u.type?300:320)),o("height",u.height||("audio"==u.type?32:240)))},dataToForm:function(){this.moveStates(!0)},formToData:function(e){("width"==e||"height"==e)&&this.changeSize(e),"source"==e?(this.moveStates(!1,e),o("source",this.editor.plugins.media.dataToHtml(this.data)),this.panel="source"):("source"==this.panel&&(this.data=t(this.editor.plugins.media.htmlToData(i("source"))),this.dataToForm(),this.panel=""),this.moveStates(!1,e),this.preview())},beforeResize:function(){this.width=parseInt(i("width")||("audio"==this.data.type?"300":"320"),10),this.height=parseInt(i("height")||("audio"==this.data.type?"32":"240"),10)},changeSize:function(t){var a,s;e("constrain").checked&&(a=parseInt(i("width")||("audio"==this.data.type?"300":"320"),10),s=parseInt(i("height")||("audio"==this.data.type?"32":"240"),10),"width"==t?(this.height=Math.round(a/this.width*s),o("height",this.height)):(this.width=Math.round(s/this.height*a),o("width",this.width)))},getMediaListHTML:function(){if("undefined"!=typeof tinyMCEMediaList&&tinyMCEMediaList.length>0){var e="";e+='<select id="linklist" name="linklist" style="width: 250px" onchange="this.form.src.value=this.options[this.selectedIndex].value;Media.formToData(\'src\');">',e+='<option value="">---</option>';for(var t=0;t<tinyMCEMediaList.length;t++)e+='<option value="'+tinyMCEMediaList[t][1]+'">'+tinyMCEMediaList[t][0]+"</option>";return e+="</select>"}return""},getMediaTypeHTML:function(e){function t(t,i){return e.schema.getElementRule(i||t)?'<option value="'+t+'">'+tinyMCEPopup.editor.translate("media_dlg."+t)+"</option>":""}var i="";return i+='<select id="media_type" name="media_type" onchange="Media.formToData(\'type\');">',i+=t("video"),i+=t("audio"),i+=t("flash","object"),i+=t("quicktime","object"),i+=t("shockwave","object"),i+=t("windowsmedia","object"),i+=t("realmedia","object"),i+=t("iframe"),e.getParam("media_embedded_audio",!1)&&(i+=t("embeddedaudio","object")),i+="</select>"},setDefaultDialogSettings:function(e){var t=e.getParam("media_dialog_defaults",{});tinymce.each(t,function(e,t){o(t,e)})}},tinyMCEPopup.requireLangPack(),tinyMCEPopup.onInit.add(function(){Media.init()})}();
!function(){function e(e){var t,a;if(e&&!e.splice){for(t=[],a=0;!0&&e[a];a++)t[a]=e[a];return t}return e}var t,a,r=tinymce.explode("id,name,width,height,style,align,class,hspace,vspace,bgcolor,type"),i=tinymce.makeMap(r.join(",")),s=tinymce.html.Node,o=tinymce.util.JSON;t=[["Flash","d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["ShockWave","166b1bca-3f9c-11cf-8075-444553540000","application/x-director","http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0"],["WindowsMedia","6bf52a52-394a-11d3-b153-00c04f79faa6,22d6f312-b0f6-11d0-94ab-0080c74c7e95,05589fa1-c356-11ce-bf01-00aa0055595a","application/x-mplayer2","http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701"],["QuickTime","02bf25d5-8c17-4b23-bc80-d3488abddc6b","video/quicktime","http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0"],["RealMedia","cfcdaa03-8be4-11cf-b84b-0020afbbccfa","audio/x-pn-realaudio-plugin","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["Java","8ad9c840-044e-11d1-b3e9-00805f499d93","application/x-java-applet","http://java.sun.com/products/plugin/autodl/jinstall-1_5_0-windows-i586.cab#Version=1,5,0,0"],["Silverlight","dfeaf541-f3e1-4c24-acac-99c30715084a","application/x-silverlight-2"],["Iframe"],["Video"],["EmbeddedAudio"],["Audio"]],tinymce.create("tinymce.plugins.MediaPlugin",{init:function(e,i){function s(t){return t&&"IMG"===t.nodeName&&e.dom.hasClass(t,"mceItemMedia")}var c,n,d,m,l=this,p={};for(l.editor=e,l.url=i,a="",c=0;c<t.length;c++){for(m=t[c][0],d={name:m,clsids:tinymce.explode(t[c][1]||""),mimes:tinymce.explode(t[c][2]||""),codebase:t[c][3]},n=0;n<d.clsids.length;n++)p["clsid:"+d.clsids[n]]=d;for(n=0;n<d.mimes.length;n++)p[d.mimes[n]]=d;p["mceItem"+m]=d,p[m.toLowerCase()]=d,a+=(a?"|":"")+m}tinymce.each(e.getParam("media_types","video=mp4,m4v,ogv,webm;silverlight=xap;flash=swf,flv;shockwave=dcr;quicktime=mov,qt,mpg,mpeg;shockwave=dcr;windowsmedia=avi,wmv,wm,asf,asx,wmx,wvx;realmedia=rm,ra,ram;java=jar;audio=mp3,ogg").split(";"),function(e){var t,a,r;for(e=e.split(/=/),a=tinymce.explode(e[1].toLowerCase()),t=0;t<a.length;t++)r=p[e[0].toLowerCase()],r&&(p[a[t]]=r)}),a=new RegExp("write("+a+")\\(([^)]+)\\)"),l.lookup=p,e.onPreInit.add(function(){e.schema.addValidElements("object[id|style|width|height|classid|codebase|*],param[name|value],embed[id|style|width|height|type|src|*],video[*],audio[*],source[*]"),e.parser.addNodeFilter("object,embed,video,audio,script,iframe",function(e){for(var t=e.length;t--;)l.objectToImg(e[t])}),e.serializer.addNodeFilter("img",function(e,t,a){for(var r,i=e.length;i--;)r=e[i],-1!==(r.attr("class")||"").indexOf("mceItemMedia")&&l.imgToObject(r,a)})}),e.onInit.add(function(){e.theme&&e.theme.onResolveName&&e.theme.onResolveName.add(function(t,a){"img"===a.name&&e.dom.hasClass(a.node,"mceItemMedia")&&(a.name="media")}),e&&e.plugins.contextmenu&&e.plugins.contextmenu.onContextMenu.add(function(e,t,a){"IMG"===a.nodeName&&-1!==a.className.indexOf("mceItemMedia")&&t.add({title:"media.edit",icon:"media",cmd:"mceMedia"})})}),e.addCommand("mceMedia",function(){var t,a;a=e.selection.getNode(),s(a)&&(t=e.dom.getAttrib(a,"data-mce-json"),t&&(t=o.parse(t),tinymce.each(r,function(r){var i=e.dom.getAttrib(a,r);i&&(t[r]=i)}),t.type=l.getType(a.className).name.toLowerCase())),t||(t={type:"flash",video:{sources:[]},params:{}}),e.windowManager.open({file:i+"/media.htm",width:430+parseInt(e.getLang("media.delta_width",0)),height:500+parseInt(e.getLang("media.delta_height",0)),inline:1},{plugin_url:i,data:t})}),e.addButton("media",{title:"media.desc",cmd:"mceMedia"}),e.onNodeChange.add(function(e,t,a){t.setActive("media",s(a))})},convertUrl:function(e,t){var a=this,r=a.editor,i=r.settings,s=i.url_converter,o=i.url_converter_scope||a;return e?t?r.documentBaseURI.toAbsolute(e):s.call(o,e,"src","object"):e},getInfo:function(){return{longname:"Media",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/media",version:tinymce.majorVersion+"."+tinymce.minorVersion}},dataToImg:function(t,a){{var r,i,s,c,n=this,d=n.editor;d.documentBaseURI}if(t.params.src=n.convertUrl(t.params.src,a),i=t.video.attrs,i&&(i.src=n.convertUrl(i.src,a)),i&&(i.poster=n.convertUrl(i.poster,a)),r=e(t.video.sources))for(c=0;c<r.length;c++)r[c].src=n.convertUrl(r[c].src,a);return s=n.editor.dom.create("img",{id:t.id,style:t.style,align:t.align,hspace:t.hspace,vspace:t.vspace,src:n.editor.theme.url+"/img/trans.gif","class":"mceItemMedia mceItem"+n.getType(t.type).name,"data-mce-json":o.serialize(t,"'")}),s.width=t.width||("audio"==t.type?"300":"320"),s.height=t.height||("audio"==t.type?"32":"240"),s},dataToHtml:function(e,t){return this.editor.serializer.serialize(this.dataToImg(e,t),{forced_root_block:"",force_absolute:t})},htmlToData:function(e){var t,a,i;return i={type:"flash",video:{sources:[]},params:{}},t=this.editor.parser.parse(e),a=t.getAll("img")[0],a&&(i=o.parse(a.attr("data-mce-json")),i.type=this.getType(a.attr("class")).name.toLowerCase(),tinymce.each(r,function(e){var t=a.attr(e);t&&(i[e]=t)})),i},getType:function(e){var t,a,r;for(a=tinymce.explode(e," "),t=0;t<a.length;t++)if(r=this.lookup[a[t]])return r},imgToObject:function(t,a){function i(e,t){var a,r,i,s,o;o=j.getParam("flash_video_player_url",I.convertUrl(I.url+"/moxieplayer.swf")),o&&(a=j.documentBaseURI,p.params.src=o,j.getParam("flash_video_player_absvideourl",!0)&&(e=a.toAbsolute(e||"",!0),t=a.toAbsolute(t||"",!0)),i="",r=j.getParam("flash_video_player_flashvars",{url:"$url",poster:"$poster"}),tinymce.each(r,function(a,r){a=a.replace(/\$url/,e||""),a=a.replace(/\$poster/,t||""),a.length>0&&(i+=(i?"&":"")+r+"="+escape(a))}),i.length&&(p.params.flashvars=i),s=j.getParam("flash_video_player_params",{allowfullscreen:!0,allowscriptaccess:!0}),tinymce.each(s,function(e,t){p.params[t]=""+e}))}var c,n,d,m,l,p,h,u,v,f,g,y,w,b,_,x,I=this,j=I.editor;if(p=t.attr("data-mce-json")){if(p=o.parse(p),f=this.getType(t.attr("class")),_=t.attr("data-mce-style"),_||(_=t.attr("style"),_&&(_=j.dom.serializeStyle(j.dom.parseStyle(_,"img")))),"Iframe"===f.name){w=new s("iframe",1),tinymce.each(r,function(e){var a=t.attr(e);"class"==e&&a&&(a=a.replace(/mceItem.+ ?/g,"")),a&&a.length>0&&w.attr(e,a)});for(m in p.params)w.attr(m,p.params[m]);return w.attr({style:_,src:p.params.src}),t.replace(w),void 0}if(this.editor.settings.media_use_script)return w=new s("script",1).attr("type","text/javascript"),l=new s("#text",3),l.value="write"+f.name+"("+o.serialize(tinymce.extend(p.params,{width:t.attr("width"),height:t.attr("height")}))+");",w.append(l),t.replace(w),void 0;if("Video"===f.name&&p.video.sources[0]){for(c=new s("video",1).attr(tinymce.extend({id:t.attr("id"),width:t.attr("width"),height:t.attr("height"),style:_},p.video.attrs)),p.video.attrs&&(b=p.video.attrs.poster),u=p.video.sources=e(p.video.sources),g=0;g<u.length;g++)/\.mp4$/.test(u[g].src)&&(y=u[g].src);for(u[0].type||(c.attr("src",u[0].src),u.splice(0,1)),g=0;g<u.length;g++)h=new s("source",1).attr(u[g]),h.shortEnded=!0,c.append(h);y?(i(y,b),f=I.getType("flash")):p.params.src=""}if("Audio"===f.name&&p.video.sources[0]){for(x=new s("audio",1).attr(tinymce.extend({id:t.attr("id"),width:t.attr("width"),height:t.attr("height"),style:_},p.video.attrs)),p.video.attrs&&(b=p.video.attrs.poster),u=p.video.sources=e(p.video.sources),u[0].type||(x.attr("src",u[0].src),u.splice(0,1)),g=0;g<u.length;g++)h=new s("source",1).attr(u[g]),h.shortEnded=!0,x.append(h);p.params.src=""}if("EmbeddedAudio"===f.name){d=new s("embed",1),d.shortEnded=!0,d.attr({id:t.attr("id"),width:t.attr("width"),height:t.attr("height"),style:_,type:t.attr("type")});for(m in p.params)d.attr(m,p.params[m]);tinymce.each(r,function(e){p[e]&&"type"!=e&&d.attr(e,p[e])}),p.params.src=""}if(p.params.src){/\.flv$/i.test(p.params.src)&&i(p.params.src,""),a&&a.force_absolute&&(p.params.src=j.documentBaseURI.toAbsolute(p.params.src)),n=new s("object",1).attr({id:t.attr("id"),width:t.attr("width"),height:t.attr("height"),style:_}),tinymce.each(r,function(e){var t=p[e];"class"==e&&t&&(t=t.replace(/mceItem.+ ?/g,"")),t&&"type"!=e&&n.attr(e,t)});for(m in p.params)v=new s("param",1),v.shortEnded=!0,l=p.params[m],"src"===m&&"WindowsMedia"===f.name&&(m="url"),v.attr({name:m,value:l}),n.append(v);if(this.editor.getParam("media_strict",!0))n.attr({data:p.params.src,type:f.mimes[0]});else{n.attr({classid:"clsid:"+f.clsids[0],codebase:f.codebase}),d=new s("embed",1),d.shortEnded=!0,d.attr({id:t.attr("id"),width:t.attr("width"),height:t.attr("height"),style:_,type:f.mimes[0]});for(m in p.params)d.attr(m,p.params[m]);tinymce.each(r,function(e){p[e]&&"type"!=e&&d.attr(e,p[e])}),n.append(d)}p.object_html&&(l=new s("#text",3),l.raw=!0,l.value=p.object_html,n.append(l)),c&&c.append(n)}c&&p.video_html&&(l=new s("#text",3),l.raw=!0,l.value=p.video_html,c.append(l)),x&&p.video_html&&(l=new s("#text",3),l.raw=!0,l.value=p.video_html,x.append(l));var M=c||x||n||d;M?t.replace(M):t.remove()}},objectToImg:function(e){function t(e){return new tinymce.html.Serializer({inner:!0,validate:!1}).serialize(e)}function c(e,t){return U[(e.attr(t)||"").toLowerCase()]}function n(e){var t=e.replace(/^.*\.([^.]+)$/,"$1");return U[t.toLowerCase()||""]}var d,m,l,p,h,u,v,f,g,y,w,b,_,x,I,j,M,A,k,T,C,N,E,P,U=this.lookup,z=this.editor.settings.url_converter,L=this.editor.settings.url_converter_scope;if(e.parent){if("script"===e.name){if(e.firstChild&&(k=a.exec(e.firstChild.value)),!k)return;A=k[1],M={video:{},params:o.parse(k[2])},f=M.params.width,g=M.params.height}if(M=M||{video:{},params:{}},h=new s("img",1),h.attr({src:this.editor.theme.url+"/img/trans.gif"}),u=e.name,"video"===u||"audio"==u){l=e,d=e.getAll("object")[0],m=e.getAll("embed")[0],f=l.attr("width"),g=l.attr("height"),v=l.attr("id"),M.video={attrs:{},sources:[]},T=M.video.attrs;for(u in l.attributes.map)T[u]=l.attributes.map[u];for(I=e.attr("src"),I&&M.video.sources.push({src:z.call(L,I,"src",e.name)}),j=l.getAll("source"),w=0;w<j.length;w++)I=j[w].remove(),M.video.sources.push({src:z.call(L,I.attr("src"),"src","source"),type:I.attr("type"),media:I.attr("media")});T.poster&&(T.poster=z.call(L,T.poster,"poster",e.name))}if("object"===e.name&&(d=e,m=e.getAll("embed")[0]),"embed"===e.name&&(m=e),"iframe"===e.name&&(p=e,A="Iframe"),d){for(f=f||d.attr("width"),g=g||d.attr("height"),y=y||d.attr("style"),v=v||d.attr("id"),C=C||d.attr("hspace"),N=N||d.attr("vspace"),E=E||d.attr("align"),P=P||d.attr("bgcolor"),M.name=d.attr("name"),x=d.getAll("param"),w=0;w<x.length;w++)_=x[w],u=_.remove().attr("name"),i[u]||(M.params[u]=_.attr("value"));M.params.src=M.params.src||d.attr("data")}if(m){f=f||m.attr("width"),g=g||m.attr("height"),y=y||m.attr("style"),v=v||m.attr("id"),C=C||m.attr("hspace"),N=N||m.attr("vspace"),E=E||m.attr("align"),P=P||m.attr("bgcolor");for(u in m.attributes.map)i[u]||M.params[u]||(M.params[u]=m.attributes.map[u])}if(p){f=p.attr("width"),g=p.attr("height"),y=y||p.attr("style"),v=p.attr("id"),C=p.attr("hspace"),N=p.attr("vspace"),E=p.attr("align"),P=p.attr("bgcolor"),tinymce.each(r,function(e){h.attr(e,p.attr(e))});for(u in p.attributes.map)i[u]||M.params[u]||(M.params[u]=p.attributes.map[u])}M.params.movie&&(M.params.src=M.params.src||M.params.movie,delete M.params.movie),M.params.src&&(M.params.src=z.call(L,M.params.src,"src","object")),l&&("video"===e.name?A=U.video.name:"audio"===e.name&&(A=U.audio.name)),d&&!A&&(A=(c(d,"clsid")||c(d,"classid")||c(d,"type")||{}).name),m&&!A&&(A=(c(m,"type")||n(M.params.src)||{}).name),m&&"EmbeddedAudio"==A&&(M.params.type=m.attr("type")),e.replace(h),m&&m.remove(),d&&(b=t(d.remove()),b&&(M.object_html=b)),l&&(b=t(l.remove()),b&&(M.video_html=b)),M.hspace=C,M.vspace=N,M.align=E,M.bgcolor=P,h.attr({id:v,"class":"mceItemMedia mceItem"+(A||"Flash"),style:y,width:f||("audio"==e.name?"300":"320"),height:g||("audio"==e.name?"32":"240"),hspace:C,vspace:N,align:E,bgcolor:P,"data-mce-json":o.serialize(M,"'")})}}}),tinymce.PluginManager.add("media",tinymce.plugins.MediaPlugin)}();